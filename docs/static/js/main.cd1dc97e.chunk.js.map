{"version":3,"sources":["components/MediaUpload/icons8-upload-to-cloud-50.png","components/MediaUpload/Dropzone.js","components/MediaUpload/Compressor.js","components/MediaUpload/utils.js","components/MediaUpload/Preview.js","components/MediaUpload/Progress.js","components/MediaUpload/index.js","App.js","index.js"],"names":["module","exports","Dropzone","props","isDisabled","onFileAdd","useState","isHighlight","setHighlight","fileInput","useRef","text","className","classNames","highlight","disabled","onDragOver","evt","preventDefault","onDragLeave","onDrop","dataTransfer","files","onClick","current","click","ref","type","onChange","target","alt","src","icon","parseValue","parseFloat","value","Compressor","file","onDone","onError","ratio","setRatio","useEffect","qualityRatio","Promise","resolve","reject","img","Image","onerror","URL","revokeObjectURL","Error","onload","width","height","canvas","document","createElement","getContext","drawImage","dataUrl","toDataURL","e","createObjectURL","compressImage","then","catch","min","max","step","_","flow","Math","round","Preview","style","backgroundImage","url","propTyes","PropTypes","object","func","Progress","pct","MediaUpload","uploadServer","setFile","progress","setProgress","serverImageUrl","setServerImageUrl","imageUrl","setImageUrl","cancel","isUploadMode","isUploadDone","isUploading","cancelBtnTxt","length","alert","key","title","href","err","message","dataURI","byteString","split","indexOf","atob","unescape","mimeString","ia","Uint8Array","i","charCodeAt","Blob","dataURItoBlob","endpoint","onProgress","formData","FormData","append","axios","post","onUploadProgress","loaded","total","resp","path","data","upload","defaultProps","App","process","REACT_APP_UPLOAD_SERVER","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.cd1dc97e.chunk.js","sourcesContent":["module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAABmJLR0QA/wD/AP+gvaeTAAADRElEQVRoge3Z3YtVVRjH8Y+jvZ1KZLJxKooSURyIDAKxF9SgiLotiKiuuyjoRtS7KAiDgvoLpiKqm/Ki94uCshcIosTQwl4gyqakdExNyWa6WM9x7+Oc2XPmnLVPU5wvbPbZe6/n5bfXftZaex8GDBhQxaI+xVmCa7AWw5jCj7F9jr/7lEfXrMez+APTs2wHMY4NvQSqq0cuwTO4sxTjK+nuH8QQLsMajJXsdmILvq0pr3mxCRPS3f4dj+Lyivar8Agmw+YQbqs1ww64FX9KCb2EkXnYXowXw/YU7s+eXYeM4Wgksr1LH4vCdgoncWOe1GbSwHW4WXokmpyFLyURj2WI83j4msCyDP5OsxIv4LjWEWcv7sLDcfy+VMi9MoR3w+eODP6QCq9ZiKekkec9fK8QNCXNBWtzBcW68HkcK3I4OyYlOy4Nq2U2SMKm8WqvwdqwM3w/0Kujj8LRExVtGhGo57vWhvsi/lu9OLk2nOyXivnfYCRy+G2uhlWFuTH2L+OvDEl1w6/SvDSM86oazibkJtwbv/fny6srJmI/Oh+jFYoCay7oVlVa1M9PkctTuANnz2WwWjGkficVWmV39ok9WueuX7DVLHV7Eb6Jhq/ggv7k2BFLcQPukSblk1Ken2qzlns+Lr4j/wg10i5gD6zEJ4qVxdLmhTFpZp7EpRkDkgp0b2zzKtY5OFdaDk1LvQSejBNPZwxESnyf4tneJ6+YURyROmEdfBaBNlYYdROkLKIuMTuUOuFQHAxncl4WcWaP5BazPnzugRNxcE4Gx2eKGFUIaXetV5aFv8PwQxxUvVd3ym4zE20KoVXMFxninR++jg7h6zh5fQbHJ6QENyuWFmUm4truaNsrV8X+ADwkqXotg+N2lHskN1sV70qWK94AN9UQrC4hDcU67PbmyW1x4mdcmTlgXUKeC78fK31oXIw3FWI2ZwyYW0hDIWJS65dKcCHeKAV+HXfjCh0snSvIIaSBq6WaaD5OR3DLbAaLo/HhUgKdbru6ELKrizjNx2lGT7RjOR7E29I801w6V20f1CjkmDRNjEuF3a+/Q1qoc/g9TY6vgguCgZCFxkDIQuN/I2RJH2J8qA/D74ABAwb8t/gHeB4agYHMcVoAAAAASUVORK5CYII=\"","import React, { useState, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport icon from './icons8-upload-to-cloud-50.png';\n\nDropzone.propTypes = {\n  isDisabled: PropTypes.bool,\n  onFileAdd: PropTypes.func\n};\nexport default function Dropzone(props) {\n  const { isDisabled, onFileAdd } = props;\n  const [isHighlight, setHighlight] = useState(false);\n  const fileInput = useRef(null);\n\n  const openFileInput = () => !isDisabled && fileInput.current.click();\n  const onDragOver = (evt) => {\n    evt.preventDefault();\n    if (!isDisabled) setHighlight(true);\n  };\n  const onDragLeave = () => setHighlight(false);\n  const onDrop = (evt) => {\n    evt.preventDefault();\n    if (isDisabled) return;\n    onFileAdd && onFileAdd(evt.dataTransfer.files);\n    setHighlight(false);\n  };\n  const onFileInputChange = (evt) => {\n    if (isDisabled) return;\n    onFileAdd && onFileAdd(evt.target.files);\n  };\n  const text = isHighlight ? 'Drop it!' : 'Click or drag file into this box to upload'\n\n  return (\n    <div\n      className={classNames('dropzone', {\n        highlight: isHighlight,\n        disabled: isDisabled\n      })}\n      onDragOver={onDragOver}\n      onDragLeave={onDragLeave}\n      onDrop={onDrop}\n      onClick={openFileInput}\n    >\n      <input\n        ref={fileInput}\n        className=\"file-input\"\n        type=\"file\"\n        onChange={onFileInputChange}\n      />\n      <img\n        alt=\"upload\"\n        className=\"Icon\"\n        src={icon}\n      />\n      <span>{text}</span>\n    </div>\n  );\n}\n","import React, { useState, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport _ from 'lodash';\nimport { compressImage } from './utils';\n\nconst parseValue = evt => parseFloat(evt.target.value);\nCompressor.propTyes = {\n  file: PropTypes.object,\n  onDone: PropTypes.func,\n  onError: PropTypes.func\n};\nexport default function Compressor(props) {\n  const { file, onDone, onError } = props;\n  const [ratio, setRatio] = useState(0.85);\n  useEffect(() => {\n    if (!file) return;\n    compressImage(file, ratio)\n      .then(onDone)\n      .catch(onError);\n  }, [ratio, file]);\n  return file ? (\n    <div className=\"compress-image\">\n      <span>Quality</span>\n      <input\n        type=\"range\"\n        value={ratio}\n        min={0.05}\n        max={1}\n        step={0.05}\n        onChange={_.flow(parseValue, setRatio)}\n      />\n      <span>{Math.round(ratio*100)}%</span>\n    </div>\n  ) : null;\n}\n","import axios from 'axios';\n\nexport const compressImage = (file, qualityRatio) =>\n  new Promise((resolve, reject) => {\n    const img = new Image();\n    img.onerror = () => {\n      URL.revokeObjectURL(img.src);\n      reject(new Error('Unexpected Error'));\n    };\n    img.onload = () => {\n      try {\n        URL.revokeObjectURL(img.src);\n        const { width, height } = img;\n        const canvas = document.createElement('canvas');\n        canvas.width = width;\n        canvas.height = height;\n        const ctx = canvas.getContext('2d');\n        ctx.drawImage(img, 0, 0, width, height);\n        const dataUrl = canvas.toDataURL('image/jpeg', qualityRatio);\n        resolve(dataUrl);\n      } catch (e) {\n        reject(e);\n      }\n    };\n    img.src = URL.createObjectURL(file);\n  });\n\nexport function dataURItoBlob(dataURI) {\n  // convert base64/URLEncoded data component to raw binary data held in a string\n  var byteString;\n  if (dataURI.split(',')[0].indexOf('base64') >= 0)\n    byteString = atob(dataURI.split(',')[1]);\n  else\n    byteString = unescape(dataURI.split(',')[1]);\n\n  // separate out the mime component\n  var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];\n\n  // write the bytes of the string to a typed array\n  var ia = new Uint8Array(byteString.length);\n  for (var i = 0; i < byteString.length; i++) {\n    ia[i] = byteString.charCodeAt(i);\n  }\n\n  return new Blob([ia], {type:mimeString});\n}\n\nconst UPLOAD_PATH='/upload';\nexport function upload(endpoint, file, onProgress, onDone, onError) {\n  const formData = new FormData();\n  formData.append('file', file);\n  axios.post(endpoint + UPLOAD_PATH, formData, {\n    onUploadProgress: (evt) => {\n      const progress = evt.loaded / evt.total;\n      onProgress(progress);\n    }\n  })\n    .then((resp) => {\n      const path = resp.data.path;\n      onDone({ path: endpoint + path });\n    })\n    .catch(onError);\n}\n","import React from 'react';\n\nexport default function Preview(props) {\n  const style = {\n    backgroundImage: `url(${props.url})`\n  };\n  return (\n    <div className=\"preview\" style={style} />\n  );\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nProgress.propTypes = {\n  value: PropTypes.number,\n};\nexport default function Progress(props) {\n  const pct = Math.round(props.value * 100);\n  const width = `${pct}%`;\n  return (\n    <div className=\"progress\">\n      <div className=\"progress-outer\">\n        <div className=\"progress-inner\" style={{width}}>\n          {width}\n        </div>\n      </div>\n    </div>\n  );\n}\n","import React, { useState, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport Dropzone from './Dropzone';\nimport Compressor from './Compressor';\nimport Preview from './Preview';\nimport { dataURItoBlob, upload } from './utils';\nimport './style.scss';\nimport Progress from './Progress';\n\nMediaUpload.propTypes = {\n  width: PropTypes.string,\n  height: PropTypes.string,\n  uploadServer: PropTypes.string\n};\nMediaUpload.defaultProps = {\n  width: '100%',\n  height: '70%',\n  uploadServer: ''\n};\nexport default function MediaUpload (props) {\n  const { width, height, uploadServer } = props;\n  const [file, setFile] = useState(null);\n  /**\n   * -1 no uploading is in progress\n   * [0, 1) uploading ...\n   * 1 upload is done\n   **/\n  const [progress, setProgress] = useState(-1);\n  const [serverImageUrl, setServerImageUrl] = useState(null);\n  const [imageUrl, setImageUrl] = useState(null);\n  const onFileAdd = (files) => {\n    if (files.length > 1) alert('Multiple files detected. Only first file being process');\n    const file = files[0];\n    setFile(file);\n  };\n  const cancel = () => {\n    setFile(null);\n    setProgress(-1);\n    setImageUrl(null);\n    setServerImageUrl(null);\n  };\n  const onCompressError = (err) => {\n    cancel();\n    alert(`Error while processing image: ${err.message}. Please try another file`)\n  };\n  const doUpload = () => {\n    const file = dataURItoBlob(imageUrl);\n    upload(uploadServer, file, setProgress, (resp) => {\n      setServerImageUrl(resp.path)\n    }, (err) => {\n      alert(`Error while uploading image: ${err.message}`);\n      setProgress(-1);\n    });\n  };\n  const isUploadMode = progress > -1;\n  const isUploadDone = serverImageUrl !== null;\n  const isUploading = isUploadMode && !isUploadDone;\n  const cancelBtnTxt = isUploadMode ? isUploadDone ? 'Done' : 'Uploading' : 'Cancel';\n  return (\n    <div className={classNames('media-upload', {\n      'upload-mode': isUploadMode,\n      'upload-done': isUploadDone\n    })} style={{width, height}}>\n      {file === null\n        ? <Dropzone onFileAdd={onFileAdd} />\n        : [\n          <div className=\"toolbar\" key={0}>\n            <button onClick={cancel} title=\"Upload another image\" disabled={isUploading}>{cancelBtnTxt}</button>\n            <div className=\"upload-status\">\n              <Progress value={progress} />\n              <a className=\"image-path\" href={serverImageUrl} title=\"Link to uploaded image\" target=\"_blank\">Link to uploaded Image</a>\n            </div>\n            <Compressor file={file} onDone={setImageUrl} onError={onCompressError} />\n            <button onClick={doUpload} className=\"btn-upload\" title=\"Upload image with current quality\">Upload</button>\n          </div>,\n          <Preview url={imageUrl} key={1} />\n        ]\n      }\n    </div>\n  );\n}","import React from 'react';\nimport './App.css';\nimport MediaUpload from './components/MediaUpload';\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <MediaUpload width=\"600px\" height=\"600px\" uploadServer={process.env.REACT_APP_UPLOAD_SERVER} />\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}